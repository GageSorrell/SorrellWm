"use strict";
exports.id = "Source_Main_MainWindow_ts";
exports.ids = ["Source_Main_MainWindow_ts"];
exports.modules = {

/***/ "./Source/Main/MainWindow.ts":
/*!***********************************!*\
  !*** ./Source/Main/MainWindow.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! path */ "path");
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _sorrellwm_windows__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @sorrellwm/windows */ "./Windows/index.js");
/* harmony import */ var _sorrellwm_windows__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_sorrellwm_windows__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var electron__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! electron */ "electron");
/* harmony import */ var electron__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(electron__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _Keyboard__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Keyboard */ "./Source/Main/Keyboard.ts");
/* harmony import */ var _Core_Utility__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Core/Utility */ "./Source/Main/Core/Utility.ts");
/* harmony import */ var _Domain_Common_Component_Keyboard_Keyboard__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/Domain/Common/Component/Keyboard/Keyboard */ "./Source/Renderer/Domain/Common/Component/Keyboard/Keyboard.ts");
/* harmony import */ var _Tree__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./Tree */ "./Source/Main/Tree.ts");
/* harmony import */ var chalk__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! chalk */ "./node_modules/chalk/source/index.js");
/* harmony import */ var chalk__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(chalk__WEBPACK_IMPORTED_MODULE_7__);
/* File:    MainWindow.ts
 * Author:  Gage Sorrell <gage@sorrell.sh>
 * License: MIT
 */








let MainWindow = undefined;
const GetLeastInvisiblePosition = () => {
    const Displays = electron__WEBPACK_IMPORTED_MODULE_2__.screen.getAllDisplays();
    const MonitorBounds = Displays.map((display) => {
        return {
            bottom: display.bounds.y + display.bounds.height,
            left: display.bounds.x,
            right: display.bounds.x + display.bounds.width,
            top: display.bounds.y
        };
    });
    MonitorBounds.sort((A, B) => A.left - B.left || A.top - B.top);
    const MaxRight = Math.max(...MonitorBounds.map((bounds) => bounds.right));
    const MaxBottom = Math.max(...MonitorBounds.map((bounds) => bounds.bottom));
    const InvisibleX = (MaxRight + 1) * 2;
    const InvisibleY = (MaxBottom + 1) * 2;
    return {
        x: InvisibleX,
        y: InvisibleY
    };
};
const LaunchMainWindow = async () => {
    console.log("Launching main window.");
    MainWindow = new electron__WEBPACK_IMPORTED_MODULE_2__.BrowserWindow({
        alwaysOnTop: true,
        frame: false,
        height: 900,
        show: true,
        skipTaskbar: true,
        title: "SorrellWm Main Window",
        titleBarStyle: "hidden",
        transparent: true,
        webPreferences: {
            devTools: false,
            // devTools: true,
            nodeIntegration: true,
            preload: electron__WEBPACK_IMPORTED_MODULE_2__.app.isPackaged
                ? path__WEBPACK_IMPORTED_MODULE_0__.join(__dirname, "Preload.js")
                : path__WEBPACK_IMPORTED_MODULE_0__.join(__dirname, "../../.erb/dll/preload.js")
        },
        width: 900,
        ...GetLeastInvisiblePosition()
    });
    MainWindow.on("show", (_Event, _IsAlwaysOnTop) => {
        MainWindow?.webContents.send("Navigate", "Main");
    });
    MainWindow.on("page-title-updated", (Event, _Title, _ExplicitSet) => {
        Event.preventDefault();
        // MainWindow?.webContents.openDevTools();
    });
    /** @TODO Find better place for this. */
    electron__WEBPACK_IMPORTED_MODULE_2__.ipcMain.on("GetAnnotatedPanels", async (_Event, ..._Arguments) => {
        const Panels = (0,_Tree__WEBPACK_IMPORTED_MODULE_6__.GetPanels)();
        const AnnotatedPanels = (await Promise.all(Panels.map(_Tree__WEBPACK_IMPORTED_MODULE_6__.AnnotatePanel)))
            .filter((Value) => {
            return Value !== undefined;
        });
        MainWindow?.webContents.send("GetAnnotatedPanels", AnnotatedPanels);
    });
    electron__WEBPACK_IMPORTED_MODULE_2__.ipcMain.on("Log", async (_Event, ...Arguments) => {
        const StringifiedArguments = Arguments
            .map((Argument) => {
            return typeof Argument === "string"
                ? Argument
                : JSON.stringify(Argument);
        })
            .join();
        const Birdie = chalk__WEBPACK_IMPORTED_MODULE_7___default().bgMagenta(" ⚛️ ") + " ";
        let OutString = Birdie;
        for (let Index = 0; Index < StringifiedArguments.length; Index++) {
            const Character = StringifiedArguments[Index];
            if (Character === "\n" && Index !== StringifiedArguments.length - 1) {
                OutString += Birdie + Character;
            }
            else {
                OutString += Character;
            }
        }
        console.log(OutString);
    });
    MainWindow.loadURL((0,_Core_Utility__WEBPACK_IMPORTED_MODULE_4__.ResolveHtmlPath)("index.html"));
};
function OnKey(Event) {
    const { State, VkCode } = Event;
    if (MainWindow === undefined) {
        return;
    }
    /** @TODO Make this a modifiable setting. */
    const ActivationKey = _Domain_Common_Component_Keyboard_Keyboard__WEBPACK_IMPORTED_MODULE_5__.Vk["+"];
    if (VkCode === ActivationKey) {
        if (State === "Down") {
            const IsTiled = (0,_Tree__WEBPACK_IMPORTED_MODULE_6__.IsWindowTiled)((0,_sorrellwm_windows__WEBPACK_IMPORTED_MODULE_1__.GetFocusedWindow)());
            console.log("Focused Window is ", (0,_sorrellwm_windows__WEBPACK_IMPORTED_MODULE_1__.GetWindowTitle)((0,_sorrellwm_windows__WEBPACK_IMPORTED_MODULE_1__.GetFocusedWindow)()));
            console.log("Forest is:", (0,_Tree__WEBPACK_IMPORTED_MODULE_6__.GetForest)());
            MainWindow.webContents.send("Navigate", "", { IsTiled });
            (0,_sorrellwm_windows__WEBPACK_IMPORTED_MODULE_1__.BlurBackground)();
        }
        else {
            (0,_sorrellwm_windows__WEBPACK_IMPORTED_MODULE_1__.UnblurBackground)();
        }
    }
    else {
        MainWindow.webContents.send("Keyboard", Event);
    }
}
electron__WEBPACK_IMPORTED_MODULE_2__.app.whenReady()
    .then(LaunchMainWindow)
    .catch(console.log);
_Keyboard__WEBPACK_IMPORTED_MODULE_3__.Keyboard.Subscribe(OnKey);


/***/ })

};
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU291cmNlX01haW5fTWFpbldpbmRvd190cy5idW5kbGUuZGV2LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7R0FHRztBQUcwQjtBQU9vQjtBQUNjO0FBR3pCO0FBQ1c7QUFDZ0I7QUFDVztBQUNsRDtBQUkxQixJQUFJLFVBQVUsR0FBOEIsU0FBUyxDQUFDO0FBRXRELE1BQU0seUJBQXlCLEdBQUcsR0FBNkIsRUFBRTtJQUU3RCxNQUFNLFFBQVEsR0FBNEIsNENBQU0sQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUdsRSxNQUFNLGFBQWEsR0FBMEIsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQXlCLEVBQWtCLEVBQUU7UUFFcEcsT0FBTztZQUNILE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU07WUFDaEQsSUFBSSxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUN0QixLQUFLLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLO1lBQzlDLEdBQUcsRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDeEIsQ0FBQztJQUNOLENBQUMsQ0FBQyxDQUFDO0lBRUgsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQWlCLEVBQUUsQ0FBaUIsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRS9GLE1BQU0sUUFBUSxHQUFXLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBc0IsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDbEcsTUFBTSxTQUFTLEdBQVcsSUFBSSxDQUFDLEdB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QUFFLGtFQUFjLENBQUMsb0VBQWdCLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDdEUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsZ0RBQVMsRUFBRSxDQUFDLENBQUM7WUFDdkMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDekQsa0VBQWMsRUFBRSxDQUFDO1FBQ3JCLENBQUM7YUFFRCxDQUFDO1lBQ0csb0VBQWdCLEVBQUUsQ0FBQztRQUN2QixDQUFDO0lBQ0wsQ0FBQztTQUVELENBQUM7UUFDRyxVQUFVLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDbkQsQ0FBQztBQUNMLENBQUM7QUFFRCx5Q0FBRyxDQUFDLFNBQVMsRUFBRTtLQUNWLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztLQUN0QixLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBRXhCLCtDQUFRLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vU29ycmVsbFdtLy4vU291cmNlL01haW4vTWFpbldpbmRvdy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBGaWxlOiAgICBNYWluV2luZG93LnRzXG4gKiBBdXRob3I6ICBHYWdlIFNvcnJlbGwgPGdhZ2VAc29ycmVsbC5zaD5cbiAqIExpY2Vuc2U6IE1JVFxuICovXG5cbmltcG9ydCAqIGFzIEZzIGZyb20gXCJmc1wiO1xuaW1wb3J0ICogYXMgUGF0aCBmcm9tIFwicGF0aFwiO1xuaW1wb3J0IHtcbiAgICBCbHVyQmFja2dyb3VuZCxcbiAgICBDYXB0dXJlU2NyZWVuU2VjdGlvblRvVGVtcFBuZ0ZpbGUsXG4gICAgdHlwZSBGQm94LFxuICAgIEdldEZvY3VzZWRXaW5kb3csXG4gICAgR2V0V2luZG93VGl0bGUsXG4gICAgVW5ibHVyQmFja2dyb3VuZCB9IGZyb20gXCJAc29ycmVsbHdtL3dpbmRvd3NcIjtcbmltcG9ydCB7IEJyb3dzZXJXaW5kb3csIGFwcCwgaXBjTWFpbiwgc2NyZWVuIH0gZnJvbSBcImVsZWN0cm9uXCI7XG5pbXBvcnQgdHlwZSB7IEZLZXlib2FyZEV2ZW50IH0gZnJvbSBcIi4vS2V5Ym9hcmQuVHlwZXNcIjtcbmltcG9ydCB0eXBlIHsgRlZpcnR1YWxLZXkgfSBmcm9tIFwiQC9Eb21haW4vQ29tbW9uL0NvbXBvbmVudC9LZXlib2FyZC9LZXlib2FyZC5UeXBlc1wiO1xuaW1wb3J0IHsgS2V5Ym9hcmQgfSBmcm9tIFwiLi9LZXlib2FyZFwiO1xuaW1wb3J0IHsgUmVzb2x2ZUh0bWxQYXRoIH0gZnJvbSBcIi4vQ29yZS9VdGlsaXR5XCI7XG5pbXBvcnQgeyBWayB9IGZyb20gXCJAL0RvbWFpbi9Db21tb24vQ29tcG9uZW50L0tleWJvYXJkL0tleWJvYXJkXCI7XG5pbXBvcnQgeyBBbm5vdGF0ZVBhbmVsLCBHZXRGb3Jlc3QsIEdldFBhbmVscywgSXNXaW5kb3dUaWxlZCB9IGZyb20gXCIuL1RyZWVcIjtcbmltcG9ydCBjaGFsayBmcm9tIFwiY2hhbGtcIjtcbmltcG9ydCB7IExvZyB9IGZyb20gXCIuL0RldmVsb3BtZW50XCI7XG5pbXBvcnQgdHlwZSB7IEZBbm5vdGF0ZWRQYW5lbCwgRlBhbmVsIH0gZnJvbSBcIi4vVHJlZS5UeXBlc1wiO1xuXG5sZXQgTWFpbldpbmRvdzogQnJvd3NlcldpbmRvdyB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcblxuY29uc3QgR2V0TGVhc3RJbnZpc2libGVQb3NpdGlvbiA9ICgpOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH0gPT5cbntcbiAgICBjb25zdCBEaXNwbGF5czogQXJyYXk8RWxlY3Ryb24uRGlzcGxheT4gPSBzY3JlZW4uZ2V0QWxsRGlzcGxheXMoKTtcblxuICAgIHR5cGUgRk1vbml0b3JCb3VuZHMgPSB7IGxlZnQ6IG51bWJlcjsgcmlnaHQ6IG51bWJlcjsgdG9wOiBudW1iZXI7IGJvdHRvbTogbnVtYmVyIH07XG4gICAgY29uc3QgTW9uaXRvckJvdW5kczogQXJyYXk8Rk1vbml0b3JCb3VuZHM+ID0gRGlzcGxheXMubWFwKChkaXNwbGF5OiBFbGVjdHJvbi5EaXNwbGF5KTogRk1vbml0b3JCb3VuZHMgPT5cbiAgICB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBib3R0b206IGRpc3BsYXkuYm91bmRzLnkgKyBkaXNwbGF5LmJvdW5kcy5oZWlnaHQsXG4gICAgICAgICAgICBsZWZ0OiBkaXNwbGF5LmJvdW5kcy54LFxuICAgICAgICAgICAgcmlnaHQ6IGRpc3BsYXkuYm91bmRzLnggKyBkaXNwbGF5LmJvdW5kcy53aWR0aCxcbiAgICAgICAgICAgIHRvcDogZGlzcGxheS5ib3VuZHMueVxuICAgICAgICB9O1xuICAgIH0pO1xuXG4gICAgTW9uaXRvckJvdW5kcy5zb3J0KChBOiBGTW9uaXRvckJvdW5kcywgQjogRk1vbml0b3JCb3VuZHMpID0+IEEubGVmdCAtIEIubGVmdCB8fCBBLnRvcCAtIEIudG9wKTtcblxuICAgIGNvbnN0IE1heFJpZ2h0OiBudW1iZXIgPSBNYXRoLm1heCguLi5Nb25pdG9yQm91bmRzLm1hcCgoYm91bmRzOiBGTW9uaXRvckJvdW5kcykgPT4gYm91bmRzLnJpZ2h0KSk7XG4gICAgY29uc3QgTWF4Qm90dG9tOiBudW1iZXIgPSBNYXRoLm1heCguLi5Nb25pdG9yQm91bmRzLm1hcCgoYm91bmRzOiBGTW9uaXRvckJvdW5kcykgPT4gYm91bmRzLmJvdHRvbSkpO1xuXG4gICAgY29uc3QgSW52aXNpYmxlWDogbnVtYmVyID0gKE1heFJpZ2h0ICsgMSkgKiAyO1xuICAgIGNvbnN0IEludmlzaWJsZVk6IG51bWJlciA9IChNYXhCb3R0b20gKyAxKSAqIDI7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICB4OiBJbnZpc2libGVYLFxuICAgICAgICB5OiBJbnZpc2libGVZXG4gICAgfTtcbn07XG5cbmNvbnN0IExhdW5jaE1haW5XaW5kb3cgPSBhc3luYyAoKTogUHJvbWlzZTx2b2lkPiA9Plxue1xuICAgIGNvbnNvbGUubG9nKFwiTGF1bmNoaW5nIG1haW4gd2luZG93LlwiKTtcbiAgICBNYWluV2luZG93ID0gbmV3IEJyb3dzZXJXaW5kb3coe1xuICAgICAgICBhbHdheXNPblRvcDogdHJ1ZSxcbiAgICAgICAgZnJhbWU6IGZhbHNlLFxuICAgICAgICBoZWlnaHQ6IDkwMCxcbiAgICAgICAgc2hvdzogdHJ1ZSxcbiAgICAgICAgc2tpcFRhc2tiYXI6IHRydWUsXG4gICAgICAgIHRpdGxlOiBcIlNvcnJlbGxXbSBNYWluIFdpbmRvd1wiLFxuICAgICAgICB0aXRsZUJhclN0eWxlOiBcImhpZGRlblwiLFxuICAgICAgICB0cmFuc3BhcmVudDogdHJ1ZSxcbiAgICAgICAgd2ViUHJlZmVyZW5jZXM6XG4gICAgICAgIHtcbiAgICAgICAgICAgIGRldlRvb2xzOiBmYWxzZSxcbiAgICAgICAgICAgIC8vIGRldlRvb2xzOiB0cnVlLFxuICAgICAgICAgICAgbm9kZUludGVncmF0aW9uOiB0cnVlLFxuICAgICAgICAgICAgcHJlbG9hZDogYXBwLmlzUGFja2FnZWRcbiAgICAgICAgICAgICAgICA/IFBhdGguam9pbihfX2Rpcm5hbWUsIFwiUHJlbG9hZC5qc1wiKVxuICAgICAgICAgICAgICAgIDogUGF0aC5qb2luKF9fZGlybmFtZSwgXCIuLi8uLi8uZXJiL2RsbC9wcmVsb2FkLmpzXCIpXG4gICAgICAgIH0sXG4gICAgICAgIHdpZHRoOiA5MDAsXG4gICAgICAgIC4uLkdldExlYXN0SW52aXNpYmxlUG9zaXRpb24oKVxuICAgIH0pO1xuXG4gICAgTWFpbldpbmRvdy5vbihcInNob3dcIiwgKF9FdmVudDogRWxlY3Ryb24uRXZlbnQsIF9Jc0Fsd2F5c09uVG9wOiBib29sZWFuKTogdm9pZCA9PlxuICAgIHtcbiAgICAgICAgTWFpbldpbmRvdz8ud2ViQ29udGVudHMuc2VuZChcIk5hdmlnYXRlXCIsIFwiTWFpblwiKTtcbiAgICB9KTtcblxuICAgIE1haW5XaW5kb3cub24oXG4gICAgICAgIFwicGFnZS10aXRsZS11cGRhdGVkXCIsXG4gICAgICAgIChFdmVudDogRWxlY3Ryb24uRXZlbnQsIF9UaXRsZTogc3RyaW5nLCBfRXhwbGljaXRTZXQ6IGJvb2xlYW4pOiB2b2lkID0+XG4gICAgICAgIHtcbiAgICAgICAgICAgIEV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAvLyBNYWluV2luZG93Py53ZWJDb250ZW50cy5vcGVuRGV2VG9vbHMoKTtcbiAgICAgICAgfVxuICAgICk7XG5cbiAgICAvKiogQFRPRE8gRmluZCBiZXR0ZXIgcGxhY2UgZm9yIHRoaXMuICovXG4gICAgaXBjTWFpbi5vbihcIkdldEFubm90YXRlZFBhbmVsc1wiLCBhc3luYyAoX0V2ZW50OiBFbGVjdHJvbi5FdmVudCwgLi4uX0FyZ3VtZW50czogQXJyYXk8dW5rbm93bj4pID0+XG4gICAge1xuICAgICAgICBjb25zdCBQYW5lbHM6IEFycmF5PEZQYW5lbD4gPSBHZXRQYW5lbHMoKTtcbiAgICAgICAgY29uc3QgQW5ub3RhdGVkUGFuZWxzOiBBcnJheTxGQW5ub3RhdGVkUGFuZWw+ID0gKGF3YWl0IFByb21pc2UuYWxsKFBhbmVscy5tYXAoQW5ub3RhdGVQYW5lbCkpKVxuICAgICAgICAgICAgLmZpbHRlcigoVmFsdWU6IEZBbm5vdGF0ZWRQYW5lbCB8IHVuZGVmaW5lZCk6IGJvb2xlYW4gPT5cbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gVmFsdWUgIT09IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH0pIGFzIEFycmF5PEZBbm5vdGF0ZWRQYW5lbD47XG5cbiAgICAgICAgTWFpbldpbmRvdz8ud2ViQ29udGVudHMuc2VuZChcIkdldEFubm90YXRlZFBhbmVsc1wiLCBBbm5vdGF0ZWRQYW5lbHMpO1xuICAgIH0pO1xuXG4gICAgaXBjTWFpbi5vbihcIkxvZ1wiLCBhc3luYyAoX0V2ZW50OiBFbGVjdHJvbi5FdmVudCwgLi4uQXJndW1lbnRzOiBBcnJheTx1bmtub3duPikgPT5cbiAgICB7XG4gICAgICAgIGNvbnN0IFN0cmluZ2lmaWVkQXJndW1lbnRzOiBzdHJpbmcgPSBBcmd1bWVudHNcbiAgICAgICAgICAgIC5tYXAoKEFyZ3VtZW50OiB1bmtub3duKTogc3RyaW5nID0+XG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBBcmd1bWVudCA9PT0gXCJzdHJpbmdcIlxuICAgICAgICAgICAgICAgICAgICA/IEFyZ3VtZW50XG4gICAgICAgICAgICAgICAgICAgIDogSlNPTi5zdHJpbmdpZnkoQXJndW1lbnQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5qb2luKCk7XG5cbiAgICAgICAgY29uc3QgQmlyZGllOiBzdHJpbmcgPSBjaGFsay5iZ01hZ2VudGEoXCIg4pqb77iPIFwiKSArIFwiIFwiO1xuICAgICAgICBsZXQgT3V0U3RyaW5nOiBzdHJpbmcgPSBCaXJkaWU7XG4gICAgICAgIGZvciAobGV0IEluZGV4OiBudW1iZXIgPSAwOyBJbmRleCA8IFN0cmluZ2lmaWVkQXJndW1lbnRzLmxlbmd0aDsgSW5kZXgrKylcbiAgICAgICAge1xuICAgICAgICAgICAgY29uc3QgQ2hhcmFjdGVyOiBzdHJpbmcgPSBTdHJpbmdpZmllZEFyZ3VtZW50c1tJbmRleF07XG4gICAgICAgICAgICBpZiAoQ2hhcmFjdGVyID09PSBcIlxcblwiICYmIEluZGV4ICE9PSBTdHJpbmdpZmllZEFyZ3VtZW50cy5sZW5ndGggLSAxKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIE91dFN0cmluZyArPSBCaXJkaWUgKyBDaGFyYWN0ZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgT3V0U3RyaW5nICs9IENoYXJhY3RlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnNvbGUubG9nKE91dFN0cmluZyk7XG4gICAgfSk7XG5cbiAgICBNYWluV2luZG93LmxvYWRVUkwoUmVzb2x2ZUh0bWxQYXRoKFwiaW5kZXguaHRtbFwiKSk7XG59O1xuXG5mdW5jdGlvbiBPbktleShFdmVudDogRktleWJvYXJkRXZlbnQpOiB2b2lkXG57XG4gICAgY29uc3QgeyBTdGF0ZSwgVmtDb2RlIH0gPSBFdmVudDtcbiAgICBpZiAoTWFpbldpbmRvdyA9PT0gdW5kZWZpbmVkKVxuICAgIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8qKiBAVE9ETyBNYWtlIHRoaXMgYSBtb2RpZmlhYmxlIHNldHRpbmcuICovXG4gICAgY29uc3QgQWN0aXZhdGlvbktleTogRlZpcnR1YWxLZXkgPSBWa1tcIitcIl07XG5cbiAgICBpZiAoVmtDb2RlID09PSBBY3RpdmF0aW9uS2V5KVxuICAgIHtcbiAgICAgICAgaWYgKFN0YXRlID09PSBcIkRvd25cIilcbiAgICAgICAge1xuICAgICAgICAgICAgY29uc3QgSXNUaWxlZDogYm9vbGVhbiA9IElzV2luZG93VGlsZWQoR2V0Rm9jdXNlZFdpbmRvdygpKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRm9jdXNlZCBXaW5kb3cgaXMgXCIsIEdldFdpbmRvd1RpdGxlKEdldEZvY3VzZWRXaW5kb3coKSkpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJGb3Jlc3QgaXM6XCIsIEdldEZvcmVzdCgpKTtcbiAgICAgICAgICAgIE1haW5XaW5kb3cud2ViQ29udGVudHMuc2VuZChcIk5hdmlnYXRlXCIsIFwiXCIsIHsgSXNUaWxlZCB9KTtcbiAgICAgICAgICAgIEJsdXJCYWNrZ3JvdW5kKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICB7XG4gICAgICAgICAgICBVbmJsdXJCYWNrZ3JvdW5kKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZVxuICAgIHtcbiAgICAgICAgTWFpbldpbmRvdy53ZWJDb250ZW50cy5zZW5kKFwiS2V5Ym9hcmRcIiwgRXZlbnQpO1xuICAgIH1cbn1cblxuYXBwLndoZW5SZWFkeSgpXG4gICAgLnRoZW4oTGF1bmNoTWFpbldpbmRvdylcbiAgICAuY2F0Y2goY29uc29sZS5sb2cpO1xuXG5LZXlib2FyZC5TdWJzY3JpYmUoT25LZXkpO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9