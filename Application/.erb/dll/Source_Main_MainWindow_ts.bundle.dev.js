"use strict";
exports.id = "Source_Main_MainWindow_ts";
exports.ids = ["Source_Main_MainWindow_ts"];
exports.modules = {

/***/ "./Source/Main/MainWindow.ts":
/*!***********************************!*\
  !*** ./Source/Main/MainWindow.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ "fs");
/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ "path");
/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _sorrellwm_windows__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @sorrellwm/windows */ "./Windows/index.js");
/* harmony import */ var _sorrellwm_windows__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_sorrellwm_windows__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var electron__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! electron */ "electron");
/* harmony import */ var electron__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(electron__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _Keyboard__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Keyboard */ "./Source/Main/Keyboard.ts");
/* harmony import */ var _Core_Utility__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./Core/Utility */ "./Source/Main/Core/Utility.ts");
/* harmony import */ var _Domain_Common_Component_Keyboard_Keyboard__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @/Domain/Common/Component/Keyboard/Keyboard */ "./Source/Renderer/Domain/Common/Component/Keyboard/Keyboard.ts");
/* harmony import */ var _Tree__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./Tree */ "./Source/Main/Tree.ts");
/* harmony import */ var chalk__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! chalk */ "./node_modules/chalk/source/index.js");
/* harmony import */ var chalk__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(chalk__WEBPACK_IMPORTED_MODULE_8__);
/* harmony import */ var _Development__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./Development */ "./Source/Main/Development/index.ts");
/* File:    MainWindow.ts
 * Author:  Gage Sorrell <gage@sorrell.sh>
 * License: MIT
 */










let MainWindow = undefined;
const GetLeastInvisiblePosition = () => {
    const Displays = electron__WEBPACK_IMPORTED_MODULE_3__.screen.getAllDisplays();
    const MonitorBounds = Displays.map((display) => {
        return {
            bottom: display.bounds.y + display.bounds.height,
            left: display.bounds.x,
            right: display.bounds.x + display.bounds.width,
            top: display.bounds.y
        };
    });
    MonitorBounds.sort((A, B) => A.left - B.left || A.top - B.top);
    const MaxRight = Math.max(...MonitorBounds.map((bounds) => bounds.right));
    const MaxBottom = Math.max(...MonitorBounds.map((bounds) => bounds.bottom));
    const InvisibleX = (MaxRight + 1) * 2;
    const InvisibleY = (MaxBottom + 1) * 2;
    return {
        x: InvisibleX,
        y: InvisibleY
    };
};
const LaunchMainWindow = async () => {
    console.log("Launching main window.");
    MainWindow = new electron__WEBPACK_IMPORTED_MODULE_3__.BrowserWindow({
        alwaysOnTop: true,
        frame: false,
        height: 900,
        show: true,
        skipTaskbar: true,
        title: "SorrellWm Main Window",
        titleBarStyle: "hidden",
        transparent: true,
        webPreferences: {
            devTools: false,
            // devTools: true,
            nodeIntegration: true,
            preload: electron__WEBPACK_IMPORTED_MODULE_3__.app.isPackaged
                ? path__WEBPACK_IMPORTED_MODULE_1__.join(__dirname, "Preload.js")
                : path__WEBPACK_IMPORTED_MODULE_1__.join(__dirname, "../../.erb/dll/preload.js")
        },
        width: 900,
        ...GetLeastInvisiblePosition()
    });
    MainWindow.on("show", (_Event, _IsAlwaysOnTop) => {
        MainWindow?.webContents.send("Navigate", "Main");
    });
    MainWindow.on("page-title-updated", (Event, _Title, _ExplicitSet) => {
        Event.preventDefault();
        // MainWindow?.webContents.openDevTools();
    });
    electron__WEBPACK_IMPORTED_MODULE_3__.ipcMain.on("GetScreenshot", async (_Event, ..._Arguments) => {
        const Panels = (0,_Tree__WEBPACK_IMPORTED_MODULE_7__.GetPanels)();
        (0,_Development__WEBPACK_IMPORTED_MODULE_9__.Log)("Panels are ", Panels);
        const TestBounds = Panels[0].Size;
        const ScreenshotFile = (0,_sorrellwm_windows__WEBPACK_IMPORTED_MODULE_2__.CaptureScreenSectionToTempPngFile)(TestBounds);
        fs__WEBPACK_IMPORTED_MODULE_0__.promises.readFile(ScreenshotFile).then((Data) => {
            const Screenshot = "data:image/png;base64," + Data.toString("base64");
            MainWindow?.webContents.send("GetScreenshot", Screenshot);
        });
    });
    electron__WEBPACK_IMPORTED_MODULE_3__.ipcMain.on("Log", async (_Event, ...Arguments) => {
        const StringifiedArguments = Arguments
            .map((Argument) => {
            return typeof Argument === "string"
                ? Argument
                : JSON.stringify(Argument);
        })
            .join();
        const Birdie = chalk__WEBPACK_IMPORTED_MODULE_8___default().bgMagenta(" ⚛️ ") + " ";
        let OutString = Birdie;
        for (let Index = 0; Index < StringifiedArguments.length; Index++) {
            const Character = StringifiedArguments[Index];
            if (Character === "\n" && Index !== StringifiedArguments.length - 1) {
                OutString += Birdie + Character;
            }
            else {
                OutString += Character;
            }
        }
        console.log(OutString);
    });
    MainWindow.loadURL((0,_Core_Utility__WEBPACK_IMPORTED_MODULE_5__.ResolveHtmlPath)("index.html"));
};
function OnKey(Event) {
    const { State, VkCode } = Event;
    if (MainWindow === undefined) {
        return;
    }
    /** @TODO Make this a modifiable setting. */
    const ActivationKey = _Domain_Common_Component_Keyboard_Keyboard__WEBPACK_IMPORTED_MODULE_6__.Vk["+"];
    if (VkCode === ActivationKey) {
        if (State === "Down") {
            const IsTiled = (0,_Tree__WEBPACK_IMPORTED_MODULE_7__.IsWindowTiled)((0,_sorrellwm_windows__WEBPACK_IMPORTED_MODULE_2__.GetFocusedWindow)());
            console.log("Focused Window is ", (0,_sorrellwm_windows__WEBPACK_IMPORTED_MODULE_2__.GetWindowTitle)((0,_sorrellwm_windows__WEBPACK_IMPORTED_MODULE_2__.GetFocusedWindow)()));
            console.log("Forest is:", (0,_Tree__WEBPACK_IMPORTED_MODULE_7__.GetForest)());
            MainWindow.webContents.send("Navigate", "", { IsTiled });
            (0,_sorrellwm_windows__WEBPACK_IMPORTED_MODULE_2__.BlurBackground)();
        }
        else {
            (0,_sorrellwm_windows__WEBPACK_IMPORTED_MODULE_2__.UnblurBackground)();
        }
    }
    else {
        MainWindow.webContents.send("Keyboard", Event);
    }
}
electron__WEBPACK_IMPORTED_MODULE_3__.app.whenReady()
    .then(LaunchMainWindow)
    .catch(console.log);
_Keyboard__WEBPACK_IMPORTED_MODULE_4__.Keyboard.Subscribe(OnKey);


/***/ })

};
;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU291cmNlX01haW5fTWFpbldpbmRvd190cy5idW5kbGUuZGV2LmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7R0FHRztBQUVzQjtBQUNJO0FBT29CO0FBQ2M7QUFHekI7QUFDVztBQUNnQjtBQUNKO0FBQ25DO0FBQ1U7QUFHcEMsSUFBSSxVQUFVLEdBQThCLFNBQVMsQ0FBQztBQUV0RCxNQUFNLHlCQUF5QixHQUFHLEdBQTZCLEVBQUU7SUFFN0QsTUFBTSxRQUFRLEdBQTRCLDRDQUFNLENBQUMsY0FBYyxFQUFFLENBQUM7SUFHbEUsTUFBTSxhQUFhLEdBQTBCLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUF5QixFQUFrQixFQUFFO1FBRXBHLE9BQU87WUFDSCxNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNO1lBQ2hELElBQUksRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdEIsS0FBSyxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSztZQUM5QyxHQUFHLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ3hCLENBQUM7SUFDTixDQUFDLENBQUMsQ0FBQztJQUVILGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFpQixFQUFFLENBQWlCLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUUvRixNQUFNLFFBQVEsR0FBVyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQXNCLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ2xHLE1BQU0sU0FBUyxHQUFX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LElBQUksS0FBSyxLQUFLLE1BQU0sRUFDcEIsQ0FBQztZQUNHLE1BQU0sT0FBTyxHQUFZLG9EQUFhLENBQUMsb0VBQWdCLEVBQUUsQ0FBQyxDQUFDO1lBQzNELE9BQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLEVBQUUsa0VBQWMsQ0FBQyxvRUFBZ0IsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUN0RSxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxnREFBUyxFQUFFLENBQUMsQ0FBQztZQUN2QyxVQUFVLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUN6RCxrRUFBYyxFQUFFLENBQUM7UUFDckIsQ0FBQzthQUVELENBQUM7WUFDRyxvRUFBZ0IsRUFBRSxDQUFDO1FBQ3ZCLENBQUM7SUFDTCxDQUFDO1NBRUQsQ0FBQztRQUNHLFVBQVUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNuRCxDQUFDO0FBQ0wsQ0FBQztBQUVELHlDQUFHLENBQUMsU0FBUyxFQUFFO0tBQ1YsSUFBSSxDQUFDLGdCQUFnQixDQUFDO0tBQ3RCLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7QUFFeEIsK0NBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9Tb3JyZWxsV20vLi9Tb3VyY2UvTWFpbi9NYWluV2luZG93LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIEZpbGU6ICAgIE1haW5XaW5kb3cudHNcbiAqIEF1dGhvcjogIEdhZ2UgU29ycmVsbCA8Z2FnZUBzb3JyZWxsLnNoPlxuICogTGljZW5zZTogTUlUXG4gKi9cblxuaW1wb3J0ICogYXMgRnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgKiBhcyBQYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQge1xuICAgIEJsdXJCYWNrZ3JvdW5kLFxuICAgIENhcHR1cmVTY3JlZW5TZWN0aW9uVG9UZW1wUG5nRmlsZSxcbiAgICB0eXBlIEZCb3gsXG4gICAgR2V0Rm9jdXNlZFdpbmRvdyxcbiAgICBHZXRXaW5kb3dUaXRsZSxcbiAgICBVbmJsdXJCYWNrZ3JvdW5kIH0gZnJvbSBcIkBzb3JyZWxsd20vd2luZG93c1wiO1xuaW1wb3J0IHsgQnJvd3NlcldpbmRvdywgYXBwLCBpcGNNYWluLCBzY3JlZW4gfSBmcm9tIFwiZWxlY3Ryb25cIjtcbmltcG9ydCB0eXBlIHsgRktleWJvYXJkRXZlbnQgfSBmcm9tIFwiLi9LZXlib2FyZC5UeXBlc1wiO1xuaW1wb3J0IHR5cGUgeyBGVmlydHVhbEtleSB9IGZyb20gXCJAL0RvbWFpbi9Db21tb24vQ29tcG9uZW50L0tleWJvYXJkL0tleWJvYXJkLlR5cGVzXCI7XG5pbXBvcnQgeyBLZXlib2FyZCB9IGZyb20gXCIuL0tleWJvYXJkXCI7XG5pbXBvcnQgeyBSZXNvbHZlSHRtbFBhdGggfSBmcm9tIFwiLi9Db3JlL1V0aWxpdHlcIjtcbmltcG9ydCB7IFZrIH0gZnJvbSBcIkAvRG9tYWluL0NvbW1vbi9Db21wb25lbnQvS2V5Ym9hcmQvS2V5Ym9hcmRcIjtcbmltcG9ydCB7IEdldEZvcmVzdCwgR2V0UGFuZWxzLCBJc1dpbmRvd1RpbGVkIH0gZnJvbSBcIi4vVHJlZVwiO1xuaW1wb3J0IGNoYWxrIGZyb20gXCJjaGFsa1wiO1xuaW1wb3J0IHsgTG9nIH0gZnJvbSBcIi4vRGV2ZWxvcG1lbnRcIjtcbmltcG9ydCB0eXBlIHsgRlBhbmVsIH0gZnJvbSBcIi4vVHJlZS5UeXBlc1wiO1xuXG5sZXQgTWFpbldpbmRvdzogQnJvd3NlcldpbmRvdyB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcblxuY29uc3QgR2V0TGVhc3RJbnZpc2libGVQb3NpdGlvbiA9ICgpOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyIH0gPT5cbntcbiAgICBjb25zdCBEaXNwbGF5czogQXJyYXk8RWxlY3Ryb24uRGlzcGxheT4gPSBzY3JlZW4uZ2V0QWxsRGlzcGxheXMoKTtcblxuICAgIHR5cGUgRk1vbml0b3JCb3VuZHMgPSB7IGxlZnQ6IG51bWJlcjsgcmlnaHQ6IG51bWJlcjsgdG9wOiBudW1iZXI7IGJvdHRvbTogbnVtYmVyIH07XG4gICAgY29uc3QgTW9uaXRvckJvdW5kczogQXJyYXk8Rk1vbml0b3JCb3VuZHM+ID0gRGlzcGxheXMubWFwKChkaXNwbGF5OiBFbGVjdHJvbi5EaXNwbGF5KTogRk1vbml0b3JCb3VuZHMgPT5cbiAgICB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBib3R0b206IGRpc3BsYXkuYm91bmRzLnkgKyBkaXNwbGF5LmJvdW5kcy5oZWlnaHQsXG4gICAgICAgICAgICBsZWZ0OiBkaXNwbGF5LmJvdW5kcy54LFxuICAgICAgICAgICAgcmlnaHQ6IGRpc3BsYXkuYm91bmRzLnggKyBkaXNwbGF5LmJvdW5kcy53aWR0aCxcbiAgICAgICAgICAgIHRvcDogZGlzcGxheS5ib3VuZHMueVxuICAgICAgICB9O1xuICAgIH0pO1xuXG4gICAgTW9uaXRvckJvdW5kcy5zb3J0KChBOiBGTW9uaXRvckJvdW5kcywgQjogRk1vbml0b3JCb3VuZHMpID0+IEEubGVmdCAtIEIubGVmdCB8fCBBLnRvcCAtIEIudG9wKTtcblxuICAgIGNvbnN0IE1heFJpZ2h0OiBudW1iZXIgPSBNYXRoLm1heCguLi5Nb25pdG9yQm91bmRzLm1hcCgoYm91bmRzOiBGTW9uaXRvckJvdW5kcykgPT4gYm91bmRzLnJpZ2h0KSk7XG4gICAgY29uc3QgTWF4Qm90dG9tOiBudW1iZXIgPSBNYXRoLm1heCguLi5Nb25pdG9yQm91bmRzLm1hcCgoYm91bmRzOiBGTW9uaXRvckJvdW5kcykgPT4gYm91bmRzLmJvdHRvbSkpO1xuXG4gICAgY29uc3QgSW52aXNpYmxlWDogbnVtYmVyID0gKE1heFJpZ2h0ICsgMSkgKiAyO1xuICAgIGNvbnN0IEludmlzaWJsZVk6IG51bWJlciA9IChNYXhCb3R0b20gKyAxKSAqIDI7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICB4OiBJbnZpc2libGVYLFxuICAgICAgICB5OiBJbnZpc2libGVZXG4gICAgfTtcbn07XG5cbmNvbnN0IExhdW5jaE1haW5XaW5kb3cgPSBhc3luYyAoKTogUHJvbWlzZTx2b2lkPiA9Plxue1xuICAgIGNvbnNvbGUubG9nKFwiTGF1bmNoaW5nIG1haW4gd2luZG93LlwiKTtcbiAgICBNYWluV2luZG93ID0gbmV3IEJyb3dzZXJXaW5kb3coe1xuICAgICAgICBhbHdheXNPblRvcDogdHJ1ZSxcbiAgICAgICAgZnJhbWU6IGZhbHNlLFxuICAgICAgICBoZWlnaHQ6IDkwMCxcbiAgICAgICAgc2hvdzogdHJ1ZSxcbiAgICAgICAgc2tpcFRhc2tiYXI6IHRydWUsXG4gICAgICAgIHRpdGxlOiBcIlNvcnJlbGxXbSBNYWluIFdpbmRvd1wiLFxuICAgICAgICB0aXRsZUJhclN0eWxlOiBcImhpZGRlblwiLFxuICAgICAgICB0cmFuc3BhcmVudDogdHJ1ZSxcbiAgICAgICAgd2ViUHJlZmVyZW5jZXM6XG4gICAgICAgIHtcbiAgICAgICAgICAgIGRldlRvb2xzOiBmYWxzZSxcbiAgICAgICAgICAgIC8vIGRldlRvb2xzOiB0cnVlLFxuICAgICAgICAgICAgbm9kZUludGVncmF0aW9uOiB0cnVlLFxuICAgICAgICAgICAgcHJlbG9hZDogYXBwLmlzUGFja2FnZWRcbiAgICAgICAgICAgICAgICA/IFBhdGguam9pbihfX2Rpcm5hbWUsIFwiUHJlbG9hZC5qc1wiKVxuICAgICAgICAgICAgICAgIDogUGF0aC5qb2luKF9fZGlybmFtZSwgXCIuLi8uLi8uZXJiL2RsbC9wcmVsb2FkLmpzXCIpXG4gICAgICAgIH0sXG4gICAgICAgIHdpZHRoOiA5MDAsXG4gICAgICAgIC4uLkdldExlYXN0SW52aXNpYmxlUG9zaXRpb24oKVxuICAgIH0pO1xuXG4gICAgTWFpbldpbmRvdy5vbihcInNob3dcIiwgKF9FdmVudDogRWxlY3Ryb24uRXZlbnQsIF9Jc0Fsd2F5c09uVG9wOiBib29sZWFuKTogdm9pZCA9PlxuICAgIHtcbiAgICAgICAgTWFpbldpbmRvdz8ud2ViQ29udGVudHMuc2VuZChcIk5hdmlnYXRlXCIsIFwiTWFpblwiKTtcbiAgICB9KTtcblxuICAgIE1haW5XaW5kb3cub24oXG4gICAgICAgIFwicGFnZS10aXRsZS11cGRhdGVkXCIsXG4gICAgICAgIChFdmVudDogRWxlY3Ryb24uRXZlbnQsIF9UaXRsZTogc3RyaW5nLCBfRXhwbGljaXRTZXQ6IGJvb2xlYW4pOiB2b2lkID0+XG4gICAgICAgIHtcbiAgICAgICAgICAgIEV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAvLyBNYWluV2luZG93Py53ZWJDb250ZW50cy5vcGVuRGV2VG9vbHMoKTtcbiAgICAgICAgfVxuICAgICk7XG5cbiAgICBpcGNNYWluLm9uKFwiR2V0U2NyZWVuc2hvdFwiLCBhc3luYyAoX0V2ZW50OiBFbGVjdHJvbi5FdmVudCwgLi4uX0FyZ3VtZW50czogQXJyYXk8dW5rbm93bj4pID0+XG4gICAge1xuICAgICAgICBjb25zdCBQYW5lbHM6IEFycmF5PEZQYW5lbD4gPSBHZXRQYW5lbHMoKTtcbiAgICAgICAgTG9nKFwiUGFuZWxzIGFyZSBcIiwgUGFuZWxzKTtcbiAgICAgICAgY29uc3QgVGVzdEJvdW5kczogRkJveCA9IChQYW5lbHNbMF0gYXMgRlBhbmVsKS5TaXplO1xuICAgICAgICBjb25zdCBTY3JlZW5zaG90RmlsZTogc3RyaW5nID0gQ2FwdHVyZVNjcmVlblNlY3Rpb25Ub1RlbXBQbmdGaWxlKFRlc3RCb3VuZHMpO1xuICAgICAgICBGcy5wcm9taXNlcy5yZWFkRmlsZShTY3JlZW5zaG90RmlsZSkudGhlbigoRGF0YTogQnVmZmVyKTogdm9pZCA9PlxuICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCBTY3JlZW5zaG90OiBzdHJpbmcgPSBcImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxcIiArIERhdGEudG9TdHJpbmcoXCJiYXNlNjRcIik7XG4gICAgICAgICAgICBNYWluV2luZG93Py53ZWJDb250ZW50cy5zZW5kKFwiR2V0U2NyZWVuc2hvdFwiLCBTY3JlZW5zaG90KTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpcGNNYWluLm9uKFwiTG9nXCIsIGFzeW5jIChfRXZlbnQ6IEVsZWN0cm9uLkV2ZW50LCAuLi5Bcmd1bWVudHM6IEFycmF5PHVua25vd24+KSA9PlxuICAgIHtcbiAgICAgICAgY29uc3QgU3RyaW5naWZpZWRBcmd1bWVudHM6IHN0cmluZyA9IEFyZ3VtZW50c1xuICAgICAgICAgICAgLm1hcCgoQXJndW1lbnQ6IHVua25vd24pOiBzdHJpbmcgPT5cbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIEFyZ3VtZW50ID09PSBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgICAgID8gQXJndW1lbnRcbiAgICAgICAgICAgICAgICAgICAgOiBKU09OLnN0cmluZ2lmeShBcmd1bWVudCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmpvaW4oKTtcblxuICAgICAgICBjb25zdCBCaXJkaWU6IHN0cmluZyA9IGNoYWxrLmJnTWFnZW50YShcIiDimpvvuI8gXCIpICsgXCIgXCI7XG4gICAgICAgIGxldCBPdXRTdHJpbmc6IHN0cmluZyA9IEJpcmRpZTtcbiAgICAgICAgZm9yIChsZXQgSW5kZXg6IG51bWJlciA9IDA7IEluZGV4IDwgU3RyaW5naWZpZWRBcmd1bWVudHMubGVuZ3RoOyBJbmRleCsrKVxuICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCBDaGFyYWN0ZXI6IHN0cmluZyA9IFN0cmluZ2lmaWVkQXJndW1lbnRzW0luZGV4XTtcbiAgICAgICAgICAgIGlmIChDaGFyYWN0ZXIgPT09IFwiXFxuXCIgJiYgSW5kZXggIT09IFN0cmluZ2lmaWVkQXJndW1lbnRzLmxlbmd0aCAtIDEpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgT3V0U3RyaW5nICs9IEJpcmRpZSArIENoYXJhY3RlcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBPdXRTdHJpbmcgKz0gQ2hhcmFjdGVyO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coT3V0U3RyaW5nKTtcbiAgICB9KTtcblxuICAgIE1haW5XaW5kb3cubG9hZFVSTChSZXNvbHZlSHRtbFBhdGgoXCJpbmRleC5odG1sXCIpKTtcbn07XG5cbmZ1bmN0aW9uIE9uS2V5KEV2ZW50OiBGS2V5Ym9hcmRFdmVudCk6IHZvaWRcbntcbiAgICBjb25zdCB7IFN0YXRlLCBWa0NvZGUgfSA9IEV2ZW50O1xuICAgIGlmIChNYWluV2luZG93ID09PSB1bmRlZmluZWQpXG4gICAge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLyoqIEBUT0RPIE1ha2UgdGhpcyBhIG1vZGlmaWFibGUgc2V0dGluZy4gKi9cbiAgICBjb25zdCBBY3RpdmF0aW9uS2V5OiBGVmlydHVhbEtleSA9IFZrW1wiK1wiXTtcblxuICAgIGlmIChWa0NvZGUgPT09IEFjdGl2YXRpb25LZXkpXG4gICAge1xuICAgICAgICBpZiAoU3RhdGUgPT09IFwiRG93blwiKVxuICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCBJc1RpbGVkOiBib29sZWFuID0gSXNXaW5kb3dUaWxlZChHZXRGb2N1c2VkV2luZG93KCkpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJGb2N1c2VkIFdpbmRvdyBpcyBcIiwgR2V0V2luZG93VGl0bGUoR2V0Rm9jdXNlZFdpbmRvdygpKSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkZvcmVzdCBpczpcIiwgR2V0Rm9yZXN0KCkpO1xuICAgICAgICAgICAgTWFpbldpbmRvdy53ZWJDb250ZW50cy5zZW5kKFwiTmF2aWdhdGVcIiwgXCJcIiwgeyBJc1RpbGVkIH0pO1xuICAgICAgICAgICAgQmx1ckJhY2tncm91bmQoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgIHtcbiAgICAgICAgICAgIFVuYmx1ckJhY2tncm91bmQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlXG4gICAge1xuICAgICAgICBNYWluV2luZG93LndlYkNvbnRlbnRzLnNlbmQoXCJLZXlib2FyZFwiLCBFdmVudCk7XG4gICAgfVxufVxuXG5hcHAud2hlblJlYWR5KClcbiAgICAudGhlbihMYXVuY2hNYWluV2luZG93KVxuICAgIC5jYXRjaChjb25zb2xlLmxvZyk7XG5cbktleWJvYXJkLlN1YnNjcmliZShPbktleSk7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=